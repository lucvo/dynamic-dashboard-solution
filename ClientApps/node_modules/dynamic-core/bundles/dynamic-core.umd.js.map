{"version":3,"file":"dynamic-core.umd.js","sources":["../../dynamic-framework/projects/dynamic-core/src/lib/services/base-settings.service.ts","../../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/dynamic-layout.service.ts","../../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/layout-outlet.directive.ts","../../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/mapped-modules.interface.ts","../../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/BaseLayoutComponent.ts","../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/master-layout/layout.component.ts","../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/template-card/template-card.component.ts","../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/template-card/template-card.container.ts","../../dynamic-framework/projects/dynamic-core/src/lib/dynamic-layout/dynamic-layout.module.ts","../../../../dynamic-framework/projects/dynamic-core/src/public-api.ts","../../../../dynamic-framework/projects/dynamic-core/src/dynamic-core.ts"],"sourcesContent":["import { AbstractClassPart } from '@angular/compiler/src/output/output_ast';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport abstract class BaseSettingsService {\n  abstract loadSettings(param: any): Observable<any>;\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LayoutContent, PageSetting } from '../models';\nimport { BaseSettingsService } from '../services/base-settings.service';\nimport { ActivatedRoute } from '@angular/router';\nimport { map, tap } from 'rxjs/operators';\nimport { Observable } from 'rxjs/internal/Observable';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DashboardService {\n\n  historyState: Array<LayoutContent> = [];\n  private subject = new BehaviorSubject<LayoutContent[]>(this.historyState);\n\n  constructor(private settingsService: BaseSettingsService) {\n\n  }\n\n  setState = (tracks: Array<LayoutContent>) => {\n    this.subject.next(tracks);\n  }\n\n  addItem = (item: PageSetting) => {\n    const state = this.subject.getValue();\n\n    if (state[0].items.indexOf(item) !== -1 || state[1].items.indexOf(item) !== -1) {\n      console.warn('Item with the same id exists on the dashboard.');\n      return;\n    }\n\n    state[0].items.length <= state[1].items.length ? state[0].items.push(item) : state[1].items.push(item);\n\n    this.subject.next(state);\n  }\n\n  removeItem = (item: PageSetting) => {\n    const state = this.subject.getValue();\n    state.forEach(track => {\n      track.items.forEach((i, index) => {\n        if (i === item) {\n          track.items.splice(index, 1);\n        }\n      });\n    });\n\n    this.subject.next(state);\n  }\n\n  loadContents = (id: any): Observable<Array<any>> => {\n    return this.settingsService.loadSettings(id).pipe(\n      map((state: Array<LayoutContent>) => {\n        this.historyState = state;\n        this.subject.next(this.historyState);\n        return state;\n      })\n    );\n  }\n}\n","import { Directive, ViewContainerRef, Input } from '@angular/core';\n\n@Directive({\n  selector: '[appLayouOutlet]',\n})\nexport class LayoutOutletDirective {\n  @Input() item;\n\n  constructor(public viewContainerRef: ViewContainerRef) {}\n}\n","import { NgModuleFactory, Type, InjectionToken } from '@angular/core';\n\nexport interface IMappedModules {\n    [key: string]: { load: () => Promise<NgModuleFactory<any> | Type<any>>; };\n}\n\nexport type DynamicModuleType = Type<any> & {\n    entryComponents: {};\n};\n\nexport const DYNAMIC_MODULES_MAP = new InjectionToken('DYNAMIC_MODULES_MAP');\n","import {\n  OnInit, ViewChildren,\n  QueryList, ChangeDetectorRef,\n  AfterViewInit, Compiler, NgModuleFactory, Injector, Inject, Component\n} from '@angular/core';\nimport { tap } from 'rxjs/operators';\nimport { LayoutOutletDirective } from './layout-outlet.directive';\nimport { PageSetting, LayoutContent } from '../models';\nimport { DashboardService } from './dynamic-layout.service';\nimport { IMappedModules, DynamicModuleType, DYNAMIC_MODULES_MAP } from './mapped-modules.interface';\nimport { TemplateCardContainer } from './template-card/template-card.container';\nimport { ActivatedRoute } from '@angular/router';\n\n@Component({\n  template: ' ',\n})\nexport class BaseLayoutComponent implements OnInit, AfterViewInit {\n  @ViewChildren(LayoutOutletDirective) dashboardOutlet: QueryList<LayoutOutletDirective>;\n\n  containers: Array<LayoutContent> = [];\n  constructor(\n    protected cd: ChangeDetectorRef,\n    protected injector: Injector,\n    protected compiler: Compiler,\n    protected service: DashboardService,\n    private route: ActivatedRoute,\n    @Inject(DYNAMIC_MODULES_MAP) protected modulesMap: IMappedModules\n  ) { }\n\n  ngOnInit(): void {\n    const id = this.route.snapshot.params['id'];\n    this.service.loadContents(id).pipe(\n      tap(tracks => (this.containers = tracks))\n      /* Make sure to unsubscribe! */\n    )\n    .subscribe(() => {\n      this.cd.detectChanges();\n      this.loadContents();\n    });\n  }\n\n  ngAfterViewInit(): void {\n  }\n\n  loadContents = () => {\n    if (!this.dashboardOutlet || !this.dashboardOutlet.length) {\n      return;\n    }\n    this.dashboardOutlet.forEach(template => {\n      this.cd.detectChanges();\n      this.loadContent(template, template.item);\n    });\n    this.cd.detectChanges();\n  }\n\n  loadContent = async (template: LayoutOutletDirective, item: PageSetting) => {\n    if (!item.name) {\n      return;\n    }\n\n    const viewContainerRef = template.viewContainerRef;\n    viewContainerRef.clear();\n    const moduleOrFactory = await this.modulesMap[item.name].load();\n    let moduleFactory;\n    if (moduleOrFactory instanceof NgModuleFactory) {\n      moduleFactory = moduleOrFactory; // AOT\n    } else {\n      moduleFactory = await this.compiler.compileModuleAsync(moduleOrFactory); // JIT\n    }\n    const moduleRef = moduleFactory.create(this.injector);\n    console.log(item.cName);\n    const rootComponent = (moduleFactory.moduleType as DynamicModuleType).entryComponents[`${item.cName}ContainerComponent`];\n    const factory = moduleRef.componentFactoryResolver.resolveComponentFactory(rootComponent);\n    const componentRef = viewContainerRef.createComponent(factory);\n    const instance = componentRef.instance as TemplateCardContainer;\n    instance.item = item;\n  }\n\n  changed = (items: Array<PageSetting>, trackIndex: number) => {\n    const state = this.containers;\n    state[trackIndex].items = items as Array<PageSetting>;\n    this.service.setState(state);\n  }\n}\n","import {\n  Component, ChangeDetectorRef,\n  Compiler, Injector, Inject\n} from '@angular/core';\n\nimport { DashboardService } from '../dynamic-layout.service';\nimport { IMappedModules, DYNAMIC_MODULES_MAP } from '../mapped-modules.interface';\nimport { BaseLayoutComponent } from '../BaseLayoutComponent';\nimport { ActivatedRoute } from '@angular/router';\n\n@Component({\n  selector: 'app-layout',\n  templateUrl: './layout.component.html',\n  styleUrls: ['./layout.component.scss'],\n})\nexport class LayoutComponent extends BaseLayoutComponent {\n\n  constructor(\n    cd: ChangeDetectorRef,\n    injector: Injector,\n    compiler: Compiler,\n    dashboardService: DashboardService,\n    route: ActivatedRoute,\n    @Inject(DYNAMIC_MODULES_MAP) modulesMap: IMappedModules\n  ) {\n    super(cd, injector, compiler, dashboardService, route, modulesMap);\n  }\n}\n\n\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'app-template-card',\n  template: ``,\n})\nexport class TemplateCardComponent {}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  template: ``,\n})\nexport class TemplateCardContainer {\n  @Input() item;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { LayoutComponent, LayoutOutletDirective, TemplateCardComponent, TemplateCardContainer, BaseLayoutComponent } from '.';\n\n@NgModule({\n  declarations: [BaseLayoutComponent, LayoutComponent, LayoutOutletDirective, TemplateCardComponent, TemplateCardContainer],\n  imports: [CommonModule],\n  exports: [BaseLayoutComponent, LayoutComponent, LayoutOutletDirective, TemplateCardComponent, TemplateCardContainer]\n})\nexport class DynamicLayoutModule { }\n","/*\n * Public API Surface of dynamic-core\n */\nexport * from './lib/services/base-settings.service';\nexport * from './lib/dynamic-layout';\nexport * from './lib/models';\nexport * from './lib/dynamic-layout/dynamic-layout.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {BaseLayoutComponent as ɵa,LayoutComponent as ɵb,LayoutOutletDirective as ɵc,TemplateCardComponent as ɵd,TemplateCardContainer as ɵe} from './lib/dynamic-layout';"],"names":["Injectable","BehaviorSubject","map","Directive","ViewContainerRef","Input","InjectionToken","NgModuleFactory","tap","Component","ChangeDetectorRef","Injector","Compiler","ActivatedRoute","Inject","ViewChildren","__extends","NgModule","CommonModule"],"mappings":"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"}